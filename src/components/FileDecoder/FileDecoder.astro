---
import '../../styles/global.css'
---

File to Base64
<form id="forms" class="space-y-2 w-full px-4 max-w-lg mx-auto">
  <textarea id="decodedResult" class="h-40 comfy-text-area"></textarea>
  <div class="text-right">
    <label for="filePicker" class="submit-button">Choose a file</label>
  </div>
  <input id="filePicker" type="file" class="hidden" />
</form>

<script>
  const getFilePicker = () => document.getElementById('filePicker')

  const resetFilePicker = () => {
    const filePicker = getFilePicker()
    if (filePicker instanceof HTMLInputElement) {
      filePicker.value = ''
    }
  }

  const initializeForm = () => {
    const form = document.getElementById(
      'decodedResult'
    ) as HTMLTextAreaElement | null
    if (form) form.value = ''

    const filePicker = getFilePicker()
    if (filePicker instanceof HTMLInputElement) {
      filePicker.addEventListener('change', encode)
    }
  }

  const encode = () => {
    const filePicker = getFilePicker()
    if (
      !(filePicker instanceof HTMLInputElement) ||
      !filePicker.files ||
      filePicker.files.length < 1
    ) {
      return
    }

    const file = filePicker.files[0]
    const fileReader = new FileReader()

    fileReader.onload = () => {
      const form = document.getElementById(
        'decodedResult'
      ) as HTMLTextAreaElement | null
      const base64 = fileReader.result

      if (form && typeof base64 === 'string') {
        form.value = base64
      }
    }

    fileReader.readAsDataURL(file)
    resetFilePicker()
  }

  document.addEventListener('DOMContentLoaded', initializeForm)
  document.addEventListener('astro:after-swap', initializeForm)
</script>
